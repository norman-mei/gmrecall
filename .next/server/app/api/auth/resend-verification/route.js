(()=>{var e={};e.id=596,e.ids=[596],e.modules={7581:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=7581,e.exports=t},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},6005:e=>{"use strict";e.exports=require("node:crypto")},1017:e=>{"use strict";e.exports=require("path")},3837:e=>{"use strict";e.exports=require("util")},9446:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>x,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{POST:()=>m});var i=r(9303),s=r(8716),n=r(670),o=r(7070),u=r(6263),c=r(9178),l=r(3493),p=r(1528);let d=u.Ryn({email:u.Z_8().email().optional()});async function m(e){let t=await (0,c.ts)(),r=await e.json().catch(()=>null),a=d.safeParse(r),i=null;if(t?i=t.email:a.success&&a.data.email&&(i=(0,c.R)(a.data.email)),!i)return o.NextResponse.json({error:"Email is required."},{status:400});let s=await l.prisma.user.findUnique({where:{email:i}});if(!s)return o.NextResponse.json({message:"If that account exists, a verification email was sent."});if(s.emailVerifiedAt)return o.NextResponse.json({message:"That account is already verified."});await (0,c.i8)(s.id);let{token:n}=await (0,c.wb)(s.id);return await (0,p.z)(s.email,n),o.NextResponse.json({message:"Verification email sent. Please check your inbox."})}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/resend-verification/route",pathname:"/api/auth/resend-verification",filename:"route",bundlePath:"app/api/auth/resend-verification/route"},resolvedPagePath:"C:\\Users\\kirk\\Downloads\\Coding Projects\\gmrecall\\app\\api\\auth\\resend-verification\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:x}=f,y="/api/auth/resend-verification/route";function v(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:w})}},9178:(e,t,r)=>{"use strict";r.d(t,{Gv:()=>p,R:()=>u,Rf:()=>w,Xz:()=>c,c_:()=>l,claimAvailableUsername:()=>m,ed:()=>h,fm:()=>d,i8:()=>v,ts:()=>x,wb:()=>y});var a=r(8691),i=r(1615),s=r(6005),n=r(3493);let o="gm_session";function u(e){return e.trim().toLowerCase()}function c(e){return e.trim().toLowerCase()}async function l(e){return a.ZP.hash(e,12)}async function p(e,t){return a.ZP.compare(e,t)}function d(e){return(0,s.createHash)("sha256").update(e).digest("hex")}async function m(e){let t=e?.trim();if(t){let e=c(t);if(!await n.prisma.user.findUnique({where:{usernameLower:e}}))return{username:t,usernameLower:e}}let r=0;for(;r<8;){let e=`user-${Math.floor(9e5*Math.random()+1e5)}`,t=c(e);if(!await n.prisma.user.findUnique({where:{usernameLower:t}}))return{username:e,usernameLower:t};r++}throw Error("Unable to assign username")}function f(){return(0,i.cookies)()}async function h(e,t=!1){let r=(0,s.randomBytes)(48).toString("hex"),a=d(r),i=new Date(Date.now()+(t?2592e6:6048e5));await n.prisma.session.create({data:{userId:e,tokenHash:a,expiresAt:i}}),f().set(o,r,{httpOnly:!0,sameSite:"lax",secure:!0,expires:i,path:"/"})}async function w(){let e=f(),t=e.get(o)?.value;if(t){let e=d(t);await n.prisma.session.deleteMany({where:{tokenHash:e}})}e.set(o,"",{httpOnly:!0,sameSite:"lax",secure:!0,expires:new Date(0),path:"/"})}async function x(){let e=f(),t=e.get(o)?.value;if(!t)return null;let r=d(t),a=await n.prisma.session.findFirst({where:{tokenHash:r,expiresAt:{gt:new Date}},include:{user:!0}});return a?a.user:(e.delete(o),null)}async function y(e){let t=(0,s.randomBytes)(48).toString("hex"),r=d(t),a=new Date(Date.now()+864e5);return{token:t,record:await n.prisma.verificationToken.create({data:{userId:e,tokenHash:r,expiresAt:a,type:"EMAIL"}})}}async function v(e){await n.prisma.verificationToken.deleteMany({where:{userId:e,type:"EMAIL"}})}},1528:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});let{APP_BASE_URL:a,NEXT_PUBLIC_BASE_URL:i}=process.env;async function s(e,t,r){let s=new URL("/api/auth/verify-email",a??i??"http://localhost:3000");s.searchParams.set("token",t),r&&s.searchParams.set("newEmail",r),console.warn("Verification email stubbed. Send this link manually:",{to:e,verifyUrl:s.toString(),newEmail:r??null})}},3493:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>u});var a=r(8879);let i=require("@prisma/client"),s=global,n=(process.env.DATABASE_URL??"file:./dev.db").replace(/^file:/,""),o=s.adapter??new a.d({url:n}),u=s.prisma||new i.PrismaClient({adapter:o,log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,979,263],()=>r(9446));module.exports=a})();