(()=>{var e={};e.id=873,e.ids=[873],e.modules={7581:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=7581,e.exports=r},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},6005:e=>{"use strict";e.exports=require("node:crypto")},1017:e=>{"use strict";e.exports=require("path")},3837:e=>{"use strict";e.exports=require("util")},3145:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w});var a={};t.r(a),t.d(a,{POST:()=>d});var s=t(9303),n=t(8716),i=t(670),o=t(7070),u=t(6263),l=t(9178),c=t(3493);let p=u.Ryn({identifier:u.Z_8().min(1),password:u.Z_8().min(1),rememberMe:u.O72().optional()});async function d(e){let r=await e.json().catch(()=>null),t=p.safeParse(r);if(!t.success)return o.NextResponse.json({error:"Invalid credentials"},{status:400});let a=t.data.identifier.trim(),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?await c.prisma.user.findUnique({where:{email:(0,l.R)(a)}}):await c.prisma.user.findUnique({where:{usernameLower:(0,l.Xz)(a)}});if(!s||!await (0,l.Gv)(t.data.password,s.passwordHash))return o.NextResponse.json({error:"Invalid credentials"},{status:401});if(!s.username)try{let e=await (0,l.claimAvailableUsername)();await c.prisma.user.update({where:{id:s.id},data:{username:e.username,usernameLower:e.usernameLower}}),s.username=e.username}catch(e){console.error("Unable to assign username to legacy user",e)}return s.emailVerifiedAt?(await (0,l.ed)(s.id,!!t.data.rememberMe),o.NextResponse.json({user:{id:s.id,email:s.email,username:s.username}})):o.NextResponse.json({error:"Please verify your email before logging in."},{status:403})}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\kirk\\Downloads\\Coding Projects\\gmrecall\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:h}=m,x="/api/auth/login/route";function g(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:w})}},9178:(e,r,t)=>{"use strict";t.d(r,{Gv:()=>p,R:()=>u,Rf:()=>h,Xz:()=>l,c_:()=>c,claimAvailableUsername:()=>m,ed:()=>w,fm:()=>d,i8:()=>y,ts:()=>x,wb:()=>g});var a=t(8691),s=t(1615),n=t(6005),i=t(3493);let o="gm_session";function u(e){return e.trim().toLowerCase()}function l(e){return e.trim().toLowerCase()}async function c(e){return a.ZP.hash(e,12)}async function p(e,r){return a.ZP.compare(e,r)}function d(e){return(0,n.createHash)("sha256").update(e).digest("hex")}async function m(e){let r=e?.trim();if(r){let e=l(r);if(!await i.prisma.user.findUnique({where:{usernameLower:e}}))return{username:r,usernameLower:e}}let t=0;for(;t<8;){let e=`user-${Math.floor(9e5*Math.random()+1e5)}`,r=l(e);if(!await i.prisma.user.findUnique({where:{usernameLower:r}}))return{username:e,usernameLower:r};t++}throw Error("Unable to assign username")}function f(){return(0,s.cookies)()}async function w(e,r=!1){let t=(0,n.randomBytes)(48).toString("hex"),a=d(t),s=new Date(Date.now()+(r?2592e6:6048e5));await i.prisma.session.create({data:{userId:e,tokenHash:a,expiresAt:s}}),f().set(o,t,{httpOnly:!0,sameSite:"lax",secure:!0,expires:s,path:"/"})}async function h(){let e=f(),r=e.get(o)?.value;if(r){let e=d(r);await i.prisma.session.deleteMany({where:{tokenHash:e}})}e.set(o,"",{httpOnly:!0,sameSite:"lax",secure:!0,expires:new Date(0),path:"/"})}async function x(){let e=f(),r=e.get(o)?.value;if(!r)return null;let t=d(r),a=await i.prisma.session.findFirst({where:{tokenHash:t,expiresAt:{gt:new Date}},include:{user:!0}});return a?a.user:(e.delete(o),null)}async function g(e){let r=(0,n.randomBytes)(48).toString("hex"),t=d(r),a=new Date(Date.now()+864e5);return{token:r,record:await i.prisma.verificationToken.create({data:{userId:e,tokenHash:t,expiresAt:a,type:"EMAIL"}})}}async function y(e){await i.prisma.verificationToken.deleteMany({where:{userId:e,type:"EMAIL"}})}},3493:(e,r,t)=>{"use strict";t.d(r,{prisma:()=>u});var a=t(8879);let s=require("@prisma/client"),n=global,i=(process.env.DATABASE_URL??"file:./dev.db").replace(/^file:/,""),o=n.adapter??new a.d({url:i}),u=n.prisma||new s.PrismaClient({adapter:o,log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,979,263],()=>t(3145));module.exports=a})();