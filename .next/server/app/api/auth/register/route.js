(()=>{var e={};e.id=2,e.ids=[2],e.modules={7581:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=7581,e.exports=t},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},6005:e=>{"use strict";e.exports=require("node:crypto")},1017:e=>{"use strict";e.exports=require("path")},3837:e=>{"use strict";e.exports=require("util")},4419:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{POST:()=>d});var s=r(9303),i=r(8716),n=r(670),o=r(7070),u=r(6263),l=r(9178),c=r(3493),p=r(1528);let m=u.Ryn({email:u.Z_8().email(),username:u.Z_8().min(2).max(32).optional(),password:u.Z_8().min(8),confirmPassword:u.Z_8().min(8)}).refine(e=>e.password===e.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});async function d(e){let t;let r=await e.json().catch(()=>null),a=m.safeParse(r);if(!a.success)return o.NextResponse.json({error:"Invalid input"},{status:400});let{email:s,password:i}=a.data,n=a.data.username?.trim(),u=(0,l.R)(s),d=await (0,l.c_)(i);if(await c.prisma.user.findUnique({where:{email:u}}))return o.NextResponse.json({error:"Email is already registered"},{status:409});let w=n&&n.length>0?n:null;try{t=await (0,l.claimAvailableUsername)(w??void 0)}catch(e){return o.NextResponse.json({error:"Unable to generate username. Try again."},{status:500})}let f=await c.prisma.user.create({data:{email:u,username:t.username,usernameLower:t.usernameLower,passwordHash:d}});try{await (0,l.i8)(f.id);let{token:e}=await (0,l.wb)(f.id);await (0,p.z)(f.email,e)}catch(e){return await c.prisma.user.delete({where:{id:f.id}}),await (0,l.i8)(f.id),console.error("Failed to send verification email",e),o.NextResponse.json({error:"Unable to send verification email. Please try again later."},{status:500})}return o.NextResponse.json({message:"Account created. Check your email for a verification link."})}let w=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\kirk\\Downloads\\Coding Projects\\gmrecall\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:x}=w,g="/api/auth/register/route";function y(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},9178:(e,t,r)=>{"use strict";r.d(t,{Gv:()=>p,R:()=>u,Rf:()=>h,Xz:()=>l,c_:()=>c,claimAvailableUsername:()=>d,ed:()=>f,fm:()=>m,i8:()=>y,ts:()=>x,wb:()=>g});var a=r(8691),s=r(1615),i=r(6005),n=r(3493);let o="gm_session";function u(e){return e.trim().toLowerCase()}function l(e){return e.trim().toLowerCase()}async function c(e){return a.ZP.hash(e,12)}async function p(e,t){return a.ZP.compare(e,t)}function m(e){return(0,i.createHash)("sha256").update(e).digest("hex")}async function d(e){let t=e?.trim();if(t){let e=l(t);if(!await n.prisma.user.findUnique({where:{usernameLower:e}}))return{username:t,usernameLower:e}}let r=0;for(;r<8;){let e=`user-${Math.floor(9e5*Math.random()+1e5)}`,t=l(e);if(!await n.prisma.user.findUnique({where:{usernameLower:t}}))return{username:e,usernameLower:t};r++}throw Error("Unable to assign username")}function w(){return(0,s.cookies)()}async function f(e,t=!1){let r=(0,i.randomBytes)(48).toString("hex"),a=m(r),s=new Date(Date.now()+(t?2592e6:6048e5));await n.prisma.session.create({data:{userId:e,tokenHash:a,expiresAt:s}}),w().set(o,r,{httpOnly:!0,sameSite:"lax",secure:!0,expires:s,path:"/"})}async function h(){let e=w(),t=e.get(o)?.value;if(t){let e=m(t);await n.prisma.session.deleteMany({where:{tokenHash:e}})}e.set(o,"",{httpOnly:!0,sameSite:"lax",secure:!0,expires:new Date(0),path:"/"})}async function x(){let e=w(),t=e.get(o)?.value;if(!t)return null;let r=m(t),a=await n.prisma.session.findFirst({where:{tokenHash:r,expiresAt:{gt:new Date}},include:{user:!0}});return a?a.user:(e.delete(o),null)}async function g(e){let t=(0,i.randomBytes)(48).toString("hex"),r=m(t),a=new Date(Date.now()+864e5);return{token:t,record:await n.prisma.verificationToken.create({data:{userId:e,tokenHash:r,expiresAt:a,type:"EMAIL"}})}}async function y(e){await n.prisma.verificationToken.deleteMany({where:{userId:e,type:"EMAIL"}})}},1528:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});let{APP_BASE_URL:a,NEXT_PUBLIC_BASE_URL:s}=process.env;async function i(e,t,r){let i=new URL("/api/auth/verify-email",a??s??"http://localhost:3000");i.searchParams.set("token",t),r&&i.searchParams.set("newEmail",r),console.warn("Verification email stubbed. Send this link manually:",{to:e,verifyUrl:i.toString(),newEmail:r??null})}},3493:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>u});var a=r(8879);let s=require("@prisma/client"),i=global,n=(process.env.DATABASE_URL??"file:./dev.db").replace(/^file:/,""),o=i.adapter??new a.d({url:n}),u=i.prisma||new s.PrismaClient({adapter:o,log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,979,263],()=>r(4419));module.exports=a})();