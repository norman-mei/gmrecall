(()=>{var e={};e.id=814,e.ids=[814],e.modules={7581:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=7581,e.exports=t},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},6005:e=>{"use strict";e.exports=require("node:crypto")},1017:e=>{"use strict";e.exports=require("path")},3837:e=>{"use strict";e.exports=require("util")},7309:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>w,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>l});var a=r(9303),n=r(8716),i=r(670),o=r(7070),u=r(6263),c=r(9178),p=r(3493);let d=u.Ryn({currentPassword:u.Z_8().min(1),newPassword:u.Z_8().min(8),confirmPassword:u.Z_8().min(8)}).refine(e=>e.newPassword===e.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});async function l(e){let t=await (0,c.ts)();if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json().catch(()=>null),s=d.safeParse(r);if(!s.success)return o.NextResponse.json({error:"Invalid input"},{status:400});if(!await (0,c.Gv)(s.data.currentPassword,t.passwordHash))return o.NextResponse.json({error:"Incorrect password"},{status:403});let a=await (0,c.c_)(s.data.newPassword);return await p.prisma.user.update({where:{id:t.id},data:{passwordHash:a}}),await p.prisma.passwordResetToken.deleteMany({where:{userId:t.id}}),o.NextResponse.json({message:"Password updated successfully."})}let w=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/change-password/route",pathname:"/api/auth/change-password",filename:"route",bundlePath:"app/api/auth/change-password/route"},resolvedPagePath:"C:\\Users\\kirk\\Downloads\\Coding Projects\\gmrecall\\app\\api\\auth\\change-password\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f}=w,x="/api/auth/change-password/route";function g(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},9178:(e,t,r)=>{"use strict";r.d(t,{Gv:()=>d,R:()=>u,Rf:()=>f,Xz:()=>c,c_:()=>p,claimAvailableUsername:()=>w,ed:()=>h,fm:()=>l,i8:()=>y,ts:()=>x,wb:()=>g});var s=r(8691),a=r(1615),n=r(6005),i=r(3493);let o="gm_session";function u(e){return e.trim().toLowerCase()}function c(e){return e.trim().toLowerCase()}async function p(e){return s.ZP.hash(e,12)}async function d(e,t){return s.ZP.compare(e,t)}function l(e){return(0,n.createHash)("sha256").update(e).digest("hex")}async function w(e){let t=e?.trim();if(t){let e=c(t);if(!await i.prisma.user.findUnique({where:{usernameLower:e}}))return{username:t,usernameLower:e}}let r=0;for(;r<8;){let e=`user-${Math.floor(9e5*Math.random()+1e5)}`,t=c(e);if(!await i.prisma.user.findUnique({where:{usernameLower:t}}))return{username:e,usernameLower:t};r++}throw Error("Unable to assign username")}function m(){return(0,a.cookies)()}async function h(e,t=!1){let r=(0,n.randomBytes)(48).toString("hex"),s=l(r),a=new Date(Date.now()+(t?2592e6:6048e5));await i.prisma.session.create({data:{userId:e,tokenHash:s,expiresAt:a}}),m().set(o,r,{httpOnly:!0,sameSite:"lax",secure:!0,expires:a,path:"/"})}async function f(){let e=m(),t=e.get(o)?.value;if(t){let e=l(t);await i.prisma.session.deleteMany({where:{tokenHash:e}})}e.set(o,"",{httpOnly:!0,sameSite:"lax",secure:!0,expires:new Date(0),path:"/"})}async function x(){let e=m(),t=e.get(o)?.value;if(!t)return null;let r=l(t),s=await i.prisma.session.findFirst({where:{tokenHash:r,expiresAt:{gt:new Date}},include:{user:!0}});return s?s.user:(e.delete(o),null)}async function g(e){let t=(0,n.randomBytes)(48).toString("hex"),r=l(t),s=new Date(Date.now()+864e5);return{token:t,record:await i.prisma.verificationToken.create({data:{userId:e,tokenHash:r,expiresAt:s,type:"EMAIL"}})}}async function y(e){await i.prisma.verificationToken.deleteMany({where:{userId:e,type:"EMAIL"}})}},3493:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>u});var s=r(8879);let a=require("@prisma/client"),n=global,i=(process.env.DATABASE_URL??"file:./dev.db").replace(/^file:/,""),o=n.adapter??new s.d({url:i}),u=n.prisma||new a.PrismaClient({adapter:o,log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,979,263],()=>r(7309));module.exports=s})();