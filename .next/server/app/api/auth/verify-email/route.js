(()=>{var e={};e.id=748,e.ids=[748],e.modules={7581:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=7581,e.exports=r},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},6005:e=>{"use strict";e.exports=require("node:crypto")},1017:e=>{"use strict";e.exports=require("path")},3837:e=>{"use strict";e.exports=require("util")},1517:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var i={};t.r(i),t.d(i,{GET:()=>p});var a=t(9303),s=t(8716),n=t(670),u=t(7070),o=t(9178),c=t(3493);function l(e,r){let t=new URL(e);return t.pathname="/account",t.search="",t.searchParams.set("verified",r),t.hash="",u.NextResponse.redirect(t,{status:"success"===r?302:303})}async function p(e){let r=new URL(e.url),t=r.searchParams.get("token"),i=r.searchParams.get("newEmail");if(!t)return l(e.url,"error");if(i){let r=(0,o.R)(i),a=(0,o.fm)(`${t}:${r}`),s=await c.prisma.verificationToken.findUnique({where:{tokenHash:a},include:{user:!0}});return!s||s.expiresAt<new Date?(s&&await c.prisma.verificationToken.delete({where:{id:s.id}}),l(e.url,"error")):!s.user.pendingEmail||s.user.pendingEmail!==r||await c.prisma.user.findUnique({where:{email:r}})?(await c.prisma.verificationToken.delete({where:{id:s.id}}),l(e.url,"error")):(await c.prisma.user.update({where:{id:s.userId},data:{email:r,pendingEmail:null,emailVerifiedAt:new Date}}),await (0,o.i8)(s.userId),l(e.url,"success"))}let a=(0,o.fm)(t),s=await c.prisma.verificationToken.findUnique({where:{tokenHash:a},include:{user:!0}});return!s||s.expiresAt<new Date?(s&&await c.prisma.verificationToken.delete({where:{id:s.id}}),l(e.url,"error")):(await c.prisma.user.update({where:{id:s.userId},data:{emailVerifiedAt:new Date}}),await (0,o.i8)(s.userId),l(e.url,"success"))}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/verify-email/route",pathname:"/api/auth/verify-email",filename:"route",bundlePath:"app/api/auth/verify-email/route"},resolvedPagePath:"C:\\Users\\kirk\\Downloads\\Coding Projects\\gmrecall\\app\\api\\auth\\verify-email\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:w}=d,h="/api/auth/verify-email/route";function x(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},9178:(e,r,t)=>{"use strict";t.d(r,{Gv:()=>p,R:()=>o,Rf:()=>h,Xz:()=>c,c_:()=>l,claimAvailableUsername:()=>m,ed:()=>w,fm:()=>d,i8:()=>y,ts:()=>x,wb:()=>v});var i=t(8691),a=t(1615),s=t(6005),n=t(3493);let u="gm_session";function o(e){return e.trim().toLowerCase()}function c(e){return e.trim().toLowerCase()}async function l(e){return i.ZP.hash(e,12)}async function p(e,r){return i.ZP.compare(e,r)}function d(e){return(0,s.createHash)("sha256").update(e).digest("hex")}async function m(e){let r=e?.trim();if(r){let e=c(r);if(!await n.prisma.user.findUnique({where:{usernameLower:e}}))return{username:r,usernameLower:e}}let t=0;for(;t<8;){let e=`user-${Math.floor(9e5*Math.random()+1e5)}`,r=c(e);if(!await n.prisma.user.findUnique({where:{usernameLower:r}}))return{username:e,usernameLower:r};t++}throw Error("Unable to assign username")}function f(){return(0,a.cookies)()}async function w(e,r=!1){let t=(0,s.randomBytes)(48).toString("hex"),i=d(t),a=new Date(Date.now()+(r?2592e6:6048e5));await n.prisma.session.create({data:{userId:e,tokenHash:i,expiresAt:a}}),f().set(u,t,{httpOnly:!0,sameSite:"lax",secure:!0,expires:a,path:"/"})}async function h(){let e=f(),r=e.get(u)?.value;if(r){let e=d(r);await n.prisma.session.deleteMany({where:{tokenHash:e}})}e.set(u,"",{httpOnly:!0,sameSite:"lax",secure:!0,expires:new Date(0),path:"/"})}async function x(){let e=f(),r=e.get(u)?.value;if(!r)return null;let t=d(r),i=await n.prisma.session.findFirst({where:{tokenHash:t,expiresAt:{gt:new Date}},include:{user:!0}});return i?i.user:(e.delete(u),null)}async function v(e){let r=(0,s.randomBytes)(48).toString("hex"),t=d(r),i=new Date(Date.now()+864e5);return{token:r,record:await n.prisma.verificationToken.create({data:{userId:e,tokenHash:t,expiresAt:i,type:"EMAIL"}})}}async function y(e){await n.prisma.verificationToken.deleteMany({where:{userId:e,type:"EMAIL"}})}},3493:(e,r,t)=>{"use strict";t.d(r,{prisma:()=>o});var i=t(8879);let a=require("@prisma/client"),s=global,n=(process.env.DATABASE_URL??"file:./dev.db").replace(/^file:/,""),u=s.adapter??new i.d({url:n}),o=s.prisma||new a.PrismaClient({adapter:u,log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[276,979],()=>t(1517));module.exports=i})();